<!DOCTYPE html>
<html lang="hr">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Lokacija Tramvaja</title>
		<link
			rel="stylesheet"
			href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
		/>
		<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
		<style>
			#map {
				height: 500px;
				width: 100%;
			}
		</style>
	</head>
	<body>
		<h2>Trenutna lokacija tramvaja 102401</h2>
		<div id="map"></div>
		<script>
			const map = L.map("map").setView([45.8131696208383, 15.957825798667], 14);
			L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
				attribution: "&copy; OpenStreetMap contributors",
			}).addTo(map);

			let marker;

			async function fetchTramLocation() {
				try {
					const response = await fetch(
						"https://zet.prometko.cyou/vehicles/locations"
					);
					const data = await response.json();
					const tram = data.features.find(
						(f) => f.properties.vehicleId === "102401"
					);

					if (tram) {
						const [lon, lat] = tram.geometry.coordinates;
						if (marker) {
							marker.setLatLng([lat, lon]);
						} else {
							marker = L.marker([lat, lon])
								.addTo(map)
								.bindPopup("Tramvaj 102401");
						}
						map.setView([lat, lon], 14);
					}
				} catch (error) {
					console.error("Greška kod dohvaćanja podataka:", error);
				}
			}

			fetchTramLocation();
			setInterval(fetchTramLocation, 500);
		</script>
	</body>
</html>
